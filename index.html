<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PET Words Adventure ğŸ®</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Fun vocabulary learning app for PET English exam">
    <meta name="theme-color" content="#6C5CE7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PET Words">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons (for iPad home screen) -->
    <link rel="apple-touch-icon" href="assets/icons/icon.svg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/icons/icon.svg">
    
    <!-- Fonts - Using China-friendly alternative (fonts.loli.net mirrors Google Fonts) -->
    <!-- Fallback: System fonts if web fonts fail to load -->
    <link rel="preconnect" href="https://fonts.loli.net" crossorigin>
    <link href="https://fonts.loli.net/css2?family=Nunito:wght@400;600;700;800&family=Fredoka+One&display=swap" rel="stylesheet" media="print" onload="this.media='all'" onerror="this.remove()">
    <noscript>
        <link href="https://fonts.loli.net/css2?family=Nunito:wght@400;600;700;800&family=Fredoka+One&display=swap" rel="stylesheet">
    </noscript>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/animations.css">
    
    <!-- LeanCloud SDK with fallback -->
    <script>
        // Show loading indicator
        window.addEventListener('DOMContentLoaded', function() {
            var loader = document.getElementById('loading-screen');
            if (loader) loader.style.display = 'flex';
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.2/dist/av-min.js" 
            onerror="console.error('LeanCloud CDN failed, trying backup...'); 
                     var s=document.createElement('script'); 
                     s.src='https://unpkg.com/leancloud-storage@4.15.2/dist/av-min.js'; 
                     document.head.appendChild(s);"></script>
    
    <!-- iPad/iOS Styles -->
    <style>
        /* Prevent pull-to-refresh on iOS */
        html, body {
            overscroll-behavior-y: contain;
        }
        /* Fallback fonts if web fonts fail to load */
        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        h1, h2, .logo-text {
            font-family: 'Fredoka One', 'PingFang SC', -apple-system, sans-serif;
        }
    </style>
</head>
<body>
    <!-- Loading Screen (shown while app initializes) -->
    <div id="loading-screen" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); z-index: 9999; justify-content: center; align-items: center; flex-direction: column;">
        <div style="font-size: 4rem; animation: bounce 1s infinite;">ğŸ“š</div>
        <div style="color: white; font-size: 1.5rem; margin-top: 1rem;">åŠ è½½ä¸­ Loading...</div>
        <style>@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }</style>
    </div>

    <!-- Animated Background -->
    <div class="bg-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
        <div class="shape shape-4"></div>
        <div class="shape shape-5"></div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <span class="login-icon">ğŸ“š</span>
                <h1>PET Words Adventure</h1>
                <p>å¼€å¯ä½ çš„å•è¯å†’é™©ä¹‹æ—…ï¼</p>
            </div>
            
            <form id="login-form" class="login-form">
                <div class="input-group">
                    <label for="username-input">ä½ çš„åå­— Your Name</label>
                    <input 
                        type="text" 
                        id="username-input" 
                        placeholder="è¾“å…¥ä½ çš„åå­—..."
                        maxlength="20"
                        autocomplete="off"
                        required
                    >
                </div>
                
                <div id="login-error" class="login-error" style="display: none;">
                    é”™è¯¯ä¿¡æ¯
                </div>
                
                <button type="submit" id="login-btn" class="login-btn">
                    ğŸš€ å¼€å§‹å­¦ä¹  Start Learning
                </button>
            </form>
            
            <div class="login-features">
                <div class="feature-item">
                    <span>ğŸ“–</span>
                    <span>1824 ä¸ªå•è¯</span>
                </div>
                <div class="feature-item">
                    <span>ğŸ®</span>
                    <span>è¶£å‘³å­¦ä¹ </span>
                </div>
                <div class="feature-item">
                    <span>ğŸ“Š</span>
                    <span>è¿›åº¦è¿½è¸ª</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="main-app" style="display: none;">
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">
                <span class="logo-icon">ğŸ“š</span>
                <h1>PET Words Adventure</h1>
            </div>
            <div class="header-right">
                <div class="header-stats">
                    <div class="stat-badge streak" title="è¿ç»­å­¦ä¹ å¤©æ•° Streak">
                        <span class="stat-icon">ğŸ”¥</span>
                        <span id="streak-count">0</span>
                        <span class="stat-label-mini">å¤©</span>
                    </div>
                    <div class="stat-badge words" title="å·²å­¦å•è¯ Words Learned">
                        <span class="stat-icon">ğŸ“–</span>
                        <span id="words-learned-display">0</span>
                        <span class="stat-label-mini">è¯</span>
                    </div>
                </div>
                <div id="user-section" class="user-section" style="display: none;">
                    <button id="leaderboard-btn" class="header-btn" title="æ’è¡Œæ¦œ Leaderboard">ğŸ†</button>
                    <button id="profile-btn" class="header-btn user-btn" title="ä¸ªäººèµ„æ–™ Profile">
                        ğŸ‘¤ <span id="user-display-name">User</span>
                    </button>
                    <button id="logout-btn" class="header-btn logout-btn" title="é€€å‡ºç™»å½• Logout">ğŸšª</button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="app-main">
            <!-- Home Screen -->
            <section id="home-screen" class="screen active">
                <div class="welcome-card">
                    <h2>æ¬¢è¿å›æ¥ï¼Œ<span id="welcome-username" class="welcome-name">å­¦ä¹ è€…</span>ï¼ğŸš€</h2>
                    <p class="welcome-subtitle">Ready to learn today?</p>
                    <div class="daily-goal">
                        <div class="goal-progress">
                            <div class="goal-bar">
                                <div id="daily-progress-bar" class="goal-fill" style="width: 0%"></div>
                            </div>
                            <span id="daily-progress-text">ä»Šæ—¥è¿›åº¦: 0/10 è¯</span>
                        </div>
                    </div>
                </div>

                <!-- Ebbinghaus Review Card -->
                <div id="review-card-section" class="review-card-section">
                    <div class="review-reminder-card" onclick="app.startReview()">
                        <div class="review-reminder-icon" id="review-icon">ğŸ§ </div>
                        <div class="review-reminder-content">
                            <h3>è‰¾å®¾æµ©æ–¯å¤ä¹  Spaced Review</h3>
                            <p id="review-message">ä½ æœ‰ <span id="review-due-count" class="review-count">0</span> ä¸ªå•è¯éœ€è¦å¤ä¹ </p>
                            <div class="review-reminder-tip" id="review-tip">
                                <span class="tip-badge">ğŸ’¡ è®°å¿†æ›²çº¿</span>
                                <span id="review-tip-text">åŠæ—¶å¤ä¹ ï¼Œè®°å¾—æ›´ç‰¢ï¼</span>
                            </div>
                        </div>
                        <div class="review-reminder-arrow" id="review-arrow">â†’</div>
                    </div>
                </div>

                <div class="topic-section">
                    <h3>ğŸ“– é€‰æ‹©ä¸»é¢˜ Choose a Topic</h3>
                    <div id="topics-grid" class="topics-grid">
                        <!-- Topics loaded dynamically -->
                    </div>
                </div>
            </section>

            <!-- Topic Detail Screen -->
            <section id="topic-screen" class="screen">
                <button class="back-btn" onclick="app.goHome()">
                    <span>â†</span> è¿”å›
                </button>
                
                <div class="topic-header">
                    <span id="topic-icon" class="topic-big-icon">ğŸ‘”</span>
                    <div class="topic-info">
                        <h2 id="topic-title">Clothes and Accessories</h2>
                        <p id="topic-subtitle">è¡£æœä¸é¥°å“</p>
                        <div class="topic-progress">
                            <div class="progress-bar">
                                <div id="topic-progress-fill" class="progress-fill"></div>
                            </div>
                            <span id="topic-progress-text">0/70 å·²å­¦ä¼š</span>
                        </div>
                    </div>
                </div>

                <div class="mode-buttons">
                    <button class="mode-btn flashcard-btn" onclick="app.startFlashcards()">
                        <span class="mode-icon">ğŸ´</span>
                        <span class="mode-text">
                            <strong>å•è¯å¡ç‰‡</strong>
                            <small>Flashcards</small>
                        </span>
                    </button>
                    <button class="mode-btn story-btn" onclick="app.startStories()">
                        <span class="mode-icon">ğŸ“–</span>
                        <span class="mode-text">
                            <strong>è¶£å‘³æ•…äº‹</strong>
                            <small>Memory Stories</small>
                        </span>
                    </button>
                    <button class="mode-btn quiz-btn" onclick="app.startQuiz()">
                        <span class="mode-icon">ğŸ¯</span>
                        <span class="mode-text">
                            <strong>å°æµ‹éªŒ</strong>
                            <small>Quiz Mode</small>
                        </span>
                    </button>
                    <button class="mode-btn library-btn" onclick="app.startLibrary()">
                        <span class="mode-icon">ğŸ“š</span>
                        <span class="mode-text">
                            <strong>å•è¯åº“</strong>
                            <small>Word Library</small>
                        </span>
                    </button>
                </div>
            </section>

            <!-- Flashcard Screen -->
            <section id="flashcard-screen" class="screen">
                <button class="back-btn" onclick="app.goToTopic()">
                    <span>â†</span> è¿”å›
                </button>

                <div class="flashcard-container">
                    <div class="flashcard-progress">
                        <span id="card-counter">1 / 70</span>
                        <div class="mini-progress">
                            <div id="card-progress-fill" class="mini-progress-fill"></div>
                        </div>
                    </div>

                    <div id="flashcard" class="flashcard" onclick="flashcard.flip()">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <span class="card-word" id="card-english">backpack</span>
                                <div class="sound-buttons">
                                    <button class="sound-btn" onclick="event.stopPropagation(); flashcard.speak();" title="Listen å¬å‘éŸ³">
                                        ğŸ”Š
                                    </button>
                                    <button class="sound-btn sound-btn-slow" onclick="event.stopPropagation(); flashcard.speakSlow();" title="Listen slowly æ…¢é€Ÿæ’­æ”¾">
                                        ğŸ¢
                                    </button>
                                </div>
                                <span class="card-hint">ç‚¹å‡»ç¿»è½¬ ğŸ‘†</span>
                            </div>
                            <div class="flashcard-back">
                                <span class="card-word" id="card-chinese">èƒŒåŒ…</span>
                                <span class="card-english-small" id="card-english-back">backpack</span>
                                <div class="sound-buttons sound-buttons-back">
                                    <button class="sound-btn sound-btn-back" onclick="event.stopPropagation(); flashcard.speak();" title="Listen å¬å‘éŸ³">
                                        ğŸ”Š
                                    </button>
                                    <button class="sound-btn sound-btn-back sound-btn-slow" onclick="event.stopPropagation(); flashcard.speakSlow();" title="Listen slowly æ…¢é€Ÿæ’­æ”¾">
                                        ğŸ¢
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Example Sentence -->
                    <div class="example-sentence">
                        <div class="example-label">ğŸ“ Example ä¾‹å¥:</div>
                        <div class="example-english" id="example-english">I carry my books in my backpack.</div>
                        <div class="example-chinese" id="example-chinese">æˆ‘ç”¨èƒŒåŒ…è£…ä¹¦ã€‚</div>
                        <button class="sound-btn-example" onclick="flashcard.speakExample()" title="Listen to example">
                            ğŸ”Š å¬ä¾‹å¥
                        </button>
                    </div>

                    <div class="flashcard-actions">
                        <button class="action-btn wrong-btn" onclick="flashcard.markWrong()">
                            <span>ğŸ˜•</span>
                            <small>å†å­¦å­¦</small>
                        </button>
                        <button class="action-btn correct-btn" onclick="flashcard.markCorrect()">
                            <span>ğŸ˜„</span>
                            <small>è®°ä½äº†!</small>
                        </button>
                    </div>

                    <div class="flashcard-nav">
                        <button class="nav-btn" onclick="flashcard.prev()">â¬…ï¸ ä¸Šä¸€ä¸ª</button>
                        <button class="nav-btn" onclick="flashcard.next()">ä¸‹ä¸€ä¸ª â¡ï¸</button>
                    </div>
                </div>
            </section>

            <!-- Story Screen -->
            <section id="story-screen" class="screen">
                <button class="back-btn" onclick="app.goToTopic()">
                    <span>â†</span> è¿”å›
                </button>

                <div class="story-container">
                    <div class="story-header">
                        <h2 id="story-title">ğŸ“– Grandma's Pool Party Disaster</h2>
                        <p id="story-title-chinese">å¥¶å¥¶çš„æ³³æ± æ´¾å¯¹ç¾éš¾</p>
                        <div class="story-stats">
                            <span class="word-count">ğŸ·ï¸ <span id="story-word-count">29</span> ä¸ªå•è¯</span>
                        </div>
                    </div>

                    <div class="story-content">
                        <div class="story-tabs">
                            <button class="story-tab active" onclick="stories.showEnglish()">English</button>
                            <button class="story-tab" onclick="stories.showChinese()">ä¸­æ–‡</button>
                            <button class="story-tab" onclick="stories.showBoth()">åŒè¯­</button>
                        </div>
                        
                        <div id="story-text" class="story-text">
                            <!-- Story content loaded dynamically -->
                        </div>
                    </div>

                    <div class="story-nav">
                        <button class="story-nav-btn" onclick="stories.prev()">â¬…ï¸ ä¸Šä¸€ä¸ªæ•…äº‹</button>
                        <span id="story-counter">1 / 4</span>
                        <button class="story-nav-btn" onclick="stories.next()">ä¸‹ä¸€ä¸ªæ•…äº‹ â¡ï¸</button>
                    </div>
                </div>

                <!-- Word Popup -->
                <div id="word-popup" class="word-popup hidden">
                    <div class="popup-content">
                        <span class="popup-english" id="popup-english">fashion</span>
                        <span class="popup-chinese" id="popup-chinese">æ—¶å°š</span>
                        <button class="popup-close" onclick="stories.closePopup()">âœ•</button>
                    </div>
                </div>
            </section>

            <!-- Word Library Screen -->
            <section id="library-screen" class="screen">
                <button class="back-btn" onclick="app.goToTopic()">
                    <span>â†</span> è¿”å›
                </button>

                <div class="library-container">
                    <div class="library-header">
                        <h2>ğŸ“š å•è¯åº“ Word Library</h2>
                        <div class="library-stats">
                            <span class="stat-learned">âœ… <span id="library-learned">0</span> å·²å­¦ä¼š</span>
                            <span class="stat-total">ğŸ“– <span id="library-total">70</span> æ€»è¯æ•°</span>
                        </div>
                    </div>

                    <div class="library-controls">
                        <div class="search-box">
                            <span class="search-icon">ğŸ”</span>
                            <input type="text" id="library-search" placeholder="æœç´¢å•è¯ Search..." oninput="library.search(this.value)">
                        </div>
                        <div class="filter-buttons">
                            <button class="filter-btn active" onclick="library.filter('all')">å…¨éƒ¨</button>
                            <button class="filter-btn" onclick="library.filter('learned')">å·²å­¦ä¼š âœ…</button>
                            <button class="filter-btn" onclick="library.filter('unlearned')">æœªå­¦ä¹  ğŸ“–</button>
                        </div>
                    </div>

                    <div id="library-list" class="library-list">
                        <!-- Words loaded dynamically -->
                    </div>
                </div>

                <!-- Word Detail Popup -->
                <div id="word-detail-popup" class="word-detail-popup hidden">
                    <div class="word-detail-content">
                        <button class="popup-close" onclick="library.closeDetail()">âœ•</button>
                        <div class="word-detail-main">
                            <span class="detail-english" id="detail-english">backpack</span>
                            <div class="detail-sound-buttons">
                                <button class="sound-btn-detail" onclick="library.speak()" title="Listen">ğŸ”Š</button>
                                <button class="sound-btn-detail" onclick="library.speakSlow()" title="Listen slowly">ğŸ¢</button>
                            </div>
                        </div>
                        <span class="detail-chinese" id="detail-chinese">èƒŒåŒ…</span>
                        <div class="detail-example">
                            <p class="detail-example-en" id="detail-example-en">I carry my books in my backpack.</p>
                            <p class="detail-example-cn" id="detail-example-cn">æˆ‘ç”¨èƒŒåŒ…è£…ä¹¦ã€‚</p>
                            <button class="sound-btn-example-detail" onclick="library.speakExample()">ğŸ”Š å¬ä¾‹å¥</button>
                        </div>
                        <div class="detail-status" id="detail-status">
                            <span class="status-learned">âœ… å·²å­¦ä¼š</span>
                        </div>
                        <button class="mark-learned-btn" id="mark-learned-btn" onclick="library.toggleLearned()">
                            æ ‡è®°ä¸ºå·²å­¦ä¼š
                        </button>
                    </div>
                </div>
            </section>

            <!-- Quiz Screen -->
            <section id="quiz-screen" class="screen">
                <button class="back-btn" onclick="app.goToTopic()">
                    <span>â†</span> è¿”å›
                </button>

                <div class="quiz-container">
                    <div class="quiz-header">
                        <div class="quiz-score">
                            <span>å¾—åˆ†: </span>
                            <span id="quiz-score">0</span>
                        </div>
                        <div class="quiz-progress">
                            <span id="quiz-counter">1 / 10</span>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h3 id="quiz-prompt">è¿™ä¸ªè¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h3>
                        <div id="quiz-word" class="quiz-word">backpack</div>
                    </div>

                    <div id="quiz-options" class="quiz-options">
                        <!-- Options loaded dynamically -->
                    </div>

                    <div id="quiz-feedback" class="quiz-feedback hidden">
                        <span id="feedback-icon">âœ…</span>
                        <span id="feedback-text">æ­£ç¡®!</span>
                    </div>

                    <button id="quiz-next-btn" class="quiz-next-btn hidden" onclick="quiz.nextQuestion()">
                        ä¸‹ä¸€é¢˜ â¡ï¸
                    </button>
                </div>

                <!-- Quiz Complete Modal -->
                <div id="quiz-complete" class="modal hidden">
                    <div class="modal-content celebration">
                        <h2>ğŸ‰ æµ‹éªŒå®Œæˆ!</h2>
                        <div class="final-score">
                            <span id="final-score">8</span>
                            <span class="score-divider">/</span>
                            <span>10</span>
                        </div>
                        <p id="score-message">å¤ªæ£’äº†ï¼ç»§ç»­åŠ æ²¹ï¼</p>
                        <div class="stars-earned">
                            <span id="stars-earned">â­â­â­</span>
                        </div>
                        <button class="primary-btn" onclick="app.goToTopic()">è¿”å›</button>
                    </div>
                </div>
            </section>

            <!-- Review Screen (Ebbinghaus) -->
            <section id="review-screen" class="screen">
                <button class="back-btn" onclick="app.goHome()">
                    <span>â†</span> è¿”å›
                </button>

                <div class="review-header-info">
                    <h2>ğŸ§  è‰¾å®¾æµ©æ–¯å¤ä¹ </h2>
                    <p class="review-subtitle">Spaced Repetition Review</p>
                </div>

                <div class="review-container">
                    <div class="review-progress">
                        <span id="review-counter">1 / 10</span>
                        <span id="review-session-stats" class="review-stats">âœ… 0 | âŒ 0</span>
                        <div class="mini-progress">
                            <div id="review-progress-fill" class="mini-progress-fill"></div>
                        </div>
                    </div>

                    <div class="review-word-info">
                        <span id="review-mastery" class="mastery-badge">ğŸ“– å­¦ä¹ ä¸­</span>
                        <span id="review-days-ago" class="days-badge">3 å¤©å‰</span>
                    </div>

                    <div id="review-card" class="flashcard review-card" onclick="review.flip()">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <span class="card-word" id="review-english">word</span>
                                <div class="sound-buttons">
                                    <button class="sound-btn" onclick="event.stopPropagation(); review.speak();" title="å¬å‘éŸ³">
                                        ğŸ”Š
                                    </button>
                                    <button class="sound-btn sound-btn-slow" onclick="event.stopPropagation(); review.speakSlow();" title="æ…¢é€Ÿæ’­æ”¾">
                                        ğŸ¢
                                    </button>
                                </div>
                                <span class="card-hint">ç‚¹å‡»ç¿»è½¬ ğŸ‘†</span>
                            </div>
                            <div class="flashcard-back">
                                <span class="card-word" id="review-chinese">è¯ä¹‰</span>
                                <span class="card-english-small" id="review-english-back">word</span>
                                <div class="sound-buttons sound-buttons-back">
                                    <button class="sound-btn sound-btn-back" onclick="event.stopPropagation(); review.speak();" title="å¬å‘éŸ³">
                                        ğŸ”Š
                                    </button>
                                </div>
                                <p class="card-example" id="review-example"></p>
                            </div>
                        </div>
                    </div>

                    <div class="review-buttons">
                        <button class="review-btn forgot-btn" onclick="review.markForgotten()">
                            <span class="btn-icon">ğŸ¤”</span>
                            <span class="btn-text">å¿˜è®°äº†</span>
                        </button>
                        <button class="review-btn remembered-btn" onclick="review.markRemembered()">
                            <span class="btn-icon">ğŸ’ª</span>
                            <span class="btn-text">è®°ä½äº†</span>
                        </button>
                    </div>

                    <div class="ebbinghaus-info">
                        <div class="curve-visual">
                            <div class="curve-bar" style="--level: 1"></div>
                            <div class="curve-bar" style="--level: 2"></div>
                            <div class="curve-bar" style="--level: 3"></div>
                            <div class="curve-bar" style="--level: 4"></div>
                        </div>
                        <p class="curve-tip">ğŸ’¡ è®°ä½ = å»¶é•¿å¤ä¹ é—´éš” | å¿˜è®° = æ˜å¤©å†å¤ä¹ </p>
                    </div>
                </div>
            </section>

            <!-- Profile Screen -->
            <section id="profile-screen" class="screen">
                <button class="back-btn" onclick="app.goHome()">
                    <span>â†</span> è¿”å›
                </button>

                <div class="profile-container">
                    <div class="profile-header">
                        <div class="profile-avatar">ğŸ‘¤</div>
                        <h2 id="profile-name">å°æ˜</h2>
                        <p class="profile-since">å­¦ä¹ å¼€å§‹äº: <span id="profile-start-date">2024-12-01</span></p>
                    </div>

                    <div class="profile-stats-grid">
                        <div class="profile-stat-card">
                            <span class="profile-stat-icon">ğŸ“…</span>
                            <span class="profile-stat-value" id="profile-days">0</span>
                            <span class="profile-stat-label">å­¦ä¹ å¤©æ•°</span>
                        </div>
                        <div class="profile-stat-card">
                            <span class="profile-stat-icon">ğŸ“–</span>
                            <span class="profile-stat-value" id="profile-words">0</span>
                            <span class="profile-stat-label">å·²å­¦å•è¯</span>
                        </div>
                        <div class="profile-stat-card">
                            <span class="profile-stat-icon">ğŸ”¥</span>
                            <span class="profile-stat-value" id="profile-streak">0</span>
                            <span class="profile-stat-label">å½“å‰è¿ç»­</span>
                        </div>
                        <div class="profile-stat-card">
                            <span class="profile-stat-icon">ğŸ†</span>
                            <span class="profile-stat-value" id="profile-best-streak">0</span>
                            <span class="profile-stat-label">æœ€é•¿è¿ç»­</span>
                        </div>
                        <div class="profile-stat-card">
                            <span class="profile-stat-icon">ğŸ“</span>
                            <span class="profile-stat-value" id="profile-quizzes">0</span>
                            <span class="profile-stat-label">æµ‹éªŒæ¬¡æ•°</span>
                        </div>
                        <div class="profile-stat-card">
                            <span class="profile-stat-icon">ğŸ¯</span>
                            <span class="profile-stat-value" id="profile-avg-score">0%</span>
                            <span class="profile-stat-label">å¹³å‡åˆ†æ•°</span>
                        </div>
                    </div>

                    <div class="profile-section">
                        <h3>ğŸ“š ä¸»é¢˜è¿›åº¦</h3>
                        <div id="topic-progress-list" class="topic-progress-list">
                            <!-- Loaded dynamically -->
                        </div>
                    </div>

                    <div class="profile-section">
                        <h3>ğŸ“ è¿‘æœŸæµ‹éªŒ</h3>
                        <div id="quiz-history-list" class="quiz-history-list">
                            <!-- Loaded dynamically -->
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Leaderboard Modal -->
        <div id="leaderboard-modal" class="modal-overlay" style="display: none;">
            <div class="leaderboard-container">
                <div class="leaderboard-header">
                    <h2>ğŸ† æ’è¡Œæ¦œ Leaderboard</h2>
                    <button id="close-leaderboard" class="modal-close-btn">âœ•</button>
                </div>
                
                <div class="leaderboard-tabs">
                    <button class="leaderboard-tab active" data-tab="words">ğŸ“– å•è¯æ•°</button>
                    <button class="leaderboard-tab" data-tab="streak">ğŸ”¥ è¿ç»­å¤©æ•°</button>
                    <button class="leaderboard-tab" data-tab="score">ğŸ¯ å¹³å‡åˆ†</button>
                </div>
                
                <div id="leaderboard-list" class="leaderboard-list">
                    <!-- Loaded dynamically -->
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="app-footer">
            <p>Made with â¤ï¸ for learning PET words</p>
        </footer>
    </div>
    </div><!-- End main-app -->

    <!-- Scripts -->
    <script src="js/db.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/leaderboard.js"></script>
    <script src="js/progress.js"></script>
    <script src="js/data-loader.js"></script>
    <script src="js/flashcard.js"></script>
    <script src="js/review.js"></script>
    <script src="js/stories.js"></script>
    <script src="js/quiz.js"></script>
    <script src="js/library.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Initialize Database and Auth -->
    <script>
        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
        function initializeApp() {
            console.log('ğŸš€ Starting initialization...');
            
            // Initialize database connection FIRST
            if (typeof DB !== 'undefined') {
                DB.init();
            }
            
            // Initialize authentication (handles login screen visibility)
            if (typeof Auth !== 'undefined') {
                console.log('ğŸ” Auth object:', Auth);
                console.log('ğŸ” Auth.init type:', typeof Auth.init);
                if (typeof Auth.init === 'function') {
                    Auth.init();
                } else {
                    console.error('âŒ Auth.init is not a function!');
                }
            } else {
                console.error('âŒ Auth module not loaded!');
            }
            
            // Initialize leaderboard
            if (typeof Leaderboard !== 'undefined') {
                Leaderboard.init();
            }
            
            // Hide loading screen
            setTimeout(function() {
                var loader = document.getElementById('loading-screen');
                if (loader) {
                    loader.style.opacity = '0';
                    loader.style.transition = 'opacity 0.3s';
                    setTimeout(function() { loader.style.display = 'none'; }, 300);
                }
            }, 500);
            
            console.log('âœ… App initialized successfully!');
        }
    </script>
    
    <!-- Service Worker Registration (for offline support) -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('âœ… Service Worker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('âŒ Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>

